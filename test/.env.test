# EDRS Test Environment Variables
# Smart isolation configuration for automated testing
# Completely separate from development and production environments

# =================================================================
# TEST ENVIRONMENT IDENTIFICATION
# =================================================================

# Environment markers (DO NOT change these)
ENVIRONMENT=test
TESTING=true
CI=true
NODE_ENV=test

# Test suite configuration
TEST_SUITE=full  # full, unit, integration, e2e, smoke
TEST_PARALLEL=true
TEST_VERBOSE=true
TEST_COVERAGE=true

# =================================================================
# INFRASTRUCTURE CONFIGURATION (Isolated Ports)
# =================================================================

# Test Database Ports (completely isolated)
TEST_POSTGRES_PORT=5434
TEST_MONGO_PORT=27019
TEST_REDIS_PORT=6381

# Test Application Ports (no conflicts)
TEST_BACKEND_PORT=8002
TEST_FRONTEND_PORT=3002
TEST_NGINX_PORT=8082

# =================================================================
# TEST DATABASE CONFIGURATION
# =================================================================

# PostgreSQL Test Database (Ephemeral)
TEST_POSTGRES_DB=edrs_test_db
TEST_POSTGRES_USER=test_user
TEST_POSTGRES_PASSWORD=test_password_123
TEST_POSTGRES_HOST=postgres-test

# MongoDB Test Database (Ephemeral)
TEST_MONGO_DB=edrs_test_mongo
TEST_MONGO_USER=test_admin
TEST_MONGO_PASSWORD=test_password_123
TEST_MONGO_HOST=mongodb-test

# Redis Test Cache (Ephemeral)
TEST_REDIS_URL=redis://test_redis_123@redis-test:6379/0
TEST_REDIS_PASSWORD=test_redis_123
TEST_REDIS_HOST=redis-test

# =================================================================
# TEST SECURITY CONFIGURATION
# =================================================================

# Django Settings Module for Testing
DJANGO_SETTINGS_MODULE=core.settings.test

# Test Django Secret (TESTING ONLY - Never use in production)
TEST_SECRET_KEY=test-django-secret-key-for-automated-testing-only-never-use-in-production

# Test JWT Configuration
TEST_JWT_SECRET_KEY=test-jwt-secret-for-automated-testing
TEST_JWT_ALGORITHM=HS256
TEST_JWT_ACCESS_TOKEN_LIFETIME=30  # Shorter for testing
TEST_JWT_REFRESH_TOKEN_LIFETIME=60

# Test Admin User (Auto-created)
TEST_ADMIN_USERNAME=testadmin
TEST_ADMIN_EMAIL=testadmin@edrs-test.local
TEST_ADMIN_PASSWORD=testpass123

# Test Regular User (Auto-created)
TEST_USER_USERNAME=testuser
TEST_USER_EMAIL=testuser@edrs-test.local
TEST_USER_PASSWORD=testpass123

# =================================================================
# TEST APPLICATION CONFIGURATION
# =================================================================

# Test Application Details
TEST_APP_NAME=EDRS Test Environment
TEST_APP_VERSION=1.0.0-test
TEST_API_VERSION=v1
TEST_API_PREFIX=api

# Test Host Configuration
TEST_BACKEND_HOST=0.0.0.0
TEST_FRONTEND_HOST=0.0.0.0
TEST_ALLOWED_HOSTS=localhost,127.0.0.1,backend-test,frontend-test

# =================================================================
# TEST CORS CONFIGURATION
# =================================================================

# Test CORS Settings (Permissive for testing)
TEST_CORS_ALLOW_ALL_ORIGINS=true
TEST_CORS_ALLOWED_ORIGINS=http://localhost:3002,http://127.0.0.1:3002,http://frontend-test:3000
TEST_CORS_ALLOW_CREDENTIALS=true

# =================================================================
# TEST EMAIL CONFIGURATION
# =================================================================

# Test Email Backend (Memory/Console)
TEST_EMAIL_BACKEND=django.core.mail.backends.locmem.EmailBackend
TEST_EMAIL_HOST=localhost
TEST_EMAIL_PORT=587
TEST_EMAIL_USE_TLS=false
TEST_DEFAULT_FROM_EMAIL=noreply@edrs-test.local

# =================================================================
# TEST FILE STORAGE CONFIGURATION
# =================================================================

# Test Static Files
TEST_STATIC_URL=/static/
TEST_STATIC_ROOT=/app/static
TEST_STATICFILES_STORAGE=django.contrib.staticfiles.storage.StaticFilesStorage

# Test Media Files
TEST_MEDIA_URL=/media/
TEST_MEDIA_ROOT=/app/media

# =================================================================
# TEST DEVELOPMENT TOOLS
# =================================================================

# Test Django Debug Settings
TEST_DEBUG=false  # Production-like testing
TEST_ENABLE_DEBUG_TOOLBAR=false
TEST_ENABLE_DJANGO_EXTENSIONS=true

# Test API Documentation
TEST_ENABLE_SWAGGER_UI=true
TEST_ENABLE_REDOC=true

# Test Frontend Settings
TEST_VITE_ENABLE_DEVTOOLS=false
TEST_VITE_ENABLE_DEBUG=true
TEST_VITE_HOT_RELOAD=false

# =================================================================
# TEST LOGGING CONFIGURATION
# =================================================================

# Test Log Levels
TEST_LOG_LEVEL=INFO
TEST_DJANGO_LOG_LEVEL=WARNING
TEST_SQL_LOG_LEVEL=WARNING  # Reduce noise

# Test Log Files
TEST_LOG_FILE=/app/logs/test.log
TEST_ERROR_LOG_FILE=/app/logs/test_error.log
TEST_ACCESS_LOG_FILE=/app/logs/test_access.log

# =================================================================
# TEST MONITORING & HEALTH CHECKS
# =================================================================

# Test Health Check Configuration
TEST_HEALTH_CHECK_ENABLED=true
TEST_HEALTH_CHECK_DATABASE=true
TEST_HEALTH_CHECK_CACHE=true
TEST_HEALTH_CHECK_TIMEOUT=5

# Test Performance Monitoring
TEST_ENABLE_PROFILING=false  # Disable for cleaner tests
TEST_ENABLE_QUERY_DEBUGGING=false

# =================================================================
# TEST FEATURE FLAGS
# =================================================================

# Test Feature Toggles
TEST_ENABLE_API_VERSIONING=true
TEST_ENABLE_RATE_LIMITING=false  # Disable for faster testing
TEST_ENABLE_AUTHENTICATION=true
TEST_ENABLE_PERMISSIONS=true

# Test Development Features
TEST_ENABLE_MOCK_DATA=true
TEST_ENABLE_TEST_ENDPOINTS=true
TEST_ENABLE_DEV_MIDDLEWARE=true

# =================================================================
# TEST THIRD-PARTY SERVICES
# =================================================================

# OpenAI Test Configuration (Mock/Disabled)
TEST_OPENAI_API_KEY=test_mock_openai_key_for_testing
TEST_ENABLE_OPENAI_INTEGRATION=false  # Use mocks for testing
TEST_OPENAI_MODEL=gpt-3.5-turbo
TEST_OPENAI_MAX_TOKENS=100  # Smaller for testing
TEST_OPENAI_TEMPERATURE=0.5

# AWS Test Services (Mock)
TEST_USE_S3=false
TEST_AWS_ACCESS_KEY_ID=test_mock_aws_key
TEST_AWS_SECRET_ACCESS_KEY=test_mock_aws_secret
TEST_AWS_STORAGE_BUCKET_NAME=edrs-test-bucket

# External APIs (Mock/Disabled)
TEST_EXTERNAL_API_BASE_URL=http://mock-api:9000
TEST_ENABLE_EXTERNAL_APIS=false

# =================================================================
# TEST DOCKER CONFIGURATION
# =================================================================

# Test Container Configuration
TEST_COMPOSE_PROJECT_NAME=edrs-test
TEST_COMPOSE_FILE=docker-compose.test.yml

# Test Build Configuration
TEST_DOCKER_BUILDKIT=1
TEST_COMPOSE_DOCKER_CLI_BUILD=1

# Test Network Configuration
TEST_DOCKER_NETWORK_SUBNET=172.25.0.0/16

# =================================================================
# TEST PERFORMANCE SETTINGS
# =================================================================

# Test Database Optimization
TEST_DB_CONN_MAX_AGE=0  # No persistent connections for tests
TEST_DB_ATOMIC_REQUESTS=true  # Wrap tests in transactions

# Test Cache Configuration
TEST_CACHE_BACKEND=django.core.cache.backends.locmem.LocMemCache
TEST_CACHE_TIMEOUT=60  # Short cache for testing

# Test Session Configuration
TEST_SESSION_ENGINE=django.contrib.sessions.backends.cache
TEST_SESSION_CACHE_ALIAS=default

# =================================================================
# TEST AUTOMATION SETTINGS
# =================================================================

# Test Runner Configuration
TEST_RUNNER_TIMEOUT=300  # 5 minutes max per test suite
TEST_RUNNER_PARALLEL_JOBS=4
TEST_RUNNER_VERBOSITY=2

# Test Coverage Settings
TEST_COVERAGE_MINIMUM=80
TEST_COVERAGE_REPORT_HTML=true
TEST_COVERAGE_REPORT_XML=true

# Test Reports
TEST_REPORTS_DIR=/reports
TEST_JUNIT_XML=true
TEST_COVERAGE_XML=true

# =================================================================
# TEST SCENARIO CONFIGURATION
# =================================================================

# Test Data Configuration
TEST_FIXTURES_ENABLED=true
TEST_SAMPLE_DATA_SIZE=small  # small, medium, large
TEST_CLEANUP_AFTER_TESTS=true

# Test User Scenarios
TEST_CREATE_DEMO_USERS=true
TEST_CREATE_SAMPLE_DOCUMENTS=true
TEST_CREATE_TEST_WORKFLOWS=true

# =================================================================
# TEST ENVIRONMENT NOTES
# =================================================================

# IMPORTANT NOTES:
# 1. This is a TESTING ENVIRONMENT ONLY
# 2. All data is EPHEMERAL and will be destroyed after tests
# 3. Uses ISOLATED ports and networks
# 4. NEVER use these credentials in production
# 5. Completely SEPARATED from development and production

# Test Environment Features:
# - Isolated Docker network (172.25.0.0/16)
# - Separate database instances with test data only
# - Mock external services for reliable testing
# - Automated test user creation
# - Performance optimizations for testing
# - Comprehensive logging and reporting
# - Clean teardown after test completion

# Usage Instructions:
# 1. Copy this file to .env.test (if needed)
# 2. Customize test scenarios as required
# 3. Run: python test-manager.py start
# 4. Execute tests: python test-manager.py test
# 5. Cleanup: python test-manager.py cleanup

# Smart Features:
# - Automatic test database seeding
# - Isolated network preventing interference
# - Ephemeral data (automatically cleaned)
# - Performance-optimized for CI/CD
# - Comprehensive test reporting
# - Zero impact on development/production